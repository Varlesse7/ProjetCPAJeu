{"ast":null,"code":"import * as conf from './conf';\n// Mur de droite = 1 et Mur haut = 0 et Mur gauche = 2  \n\nconst randomInt = max => Math.floor(Math.random() * max);\nconst randomSign = () => Math.sign(Math.random() - 0.5);\nconst dist2 = (o1, o2) => Math.pow(o1.x - o2.x, 2) + Math.pow(o1.y - o2.y, 2);\nconst iterate = bound => ball => {\n  return {\n    ...ball,\n    coord: {\n      ...ball.coord,\n      x: ball.coord.x + ball.coord.dx,\n      y: ball.coord.y + ball.coord.dy\n    }\n  };\n};\nconst mouvDebris = bound => ball => {\n  return {\n    ...ball,\n    coord: {\n      ...ball.coord,\n      x: ball.coord.x + ball.coord.dx,\n      y: ball.coord.y + ball.coord.dy\n    }\n  };\n};\nconst mouvTirD = bound => ([i, rect]) => {\n  let newdy = rect.coord.dy;\n  if (rect.coord.y === 200) {\n    newdy = 0;\n  }\n  return [i, {\n    ...rect,\n    coord: {\n      ...rect.coord,\n      y: rect.coord.y + newdy,\n      dy: newdy\n    }\n  }];\n  ;\n};\nexport const click = state => event => {\n  const {\n    offsetX,\n    offsetY\n  } = event;\n  const target = state.pos.find(p => dist2(p.coord, {\n    x: offsetX,\n    y: offsetY,\n    dx: 0,\n    dy: 0\n  }) < Math.pow(conf.RADIUS, 2) + 100);\n  if (target) {\n    target.coord.dx += Math.random() * 10;\n    target.coord.dy += Math.random() * 10;\n  }\n  return state;\n};\nconst collideBOC = (b, oc) => dist2(b, {\n  x: oc.coord.x,\n  y: oc.coord.y,\n  dx: 0,\n  dy: 0\n}) < Math.pow(conf.RADIUS + oc.radius, 2);\nconst collideROC = (h, oc) => {\n  const hx = h.coord.x;\n  const hy = h.coord.y;\n  const hw = h.hitBox.hx;\n  const hh = h.hitBox.hy;\n  const cx = oc.coord.x;\n  const cy = oc.coord.y;\n  const cr = oc.radius;\n  const nearestX = Math.max(hx - hw / 2, Math.min(cx, hx + hw / 2));\n  const nearestY = Math.max(hy - hh / 2, Math.min(cy, hy + hh / 2));\n  const distX = cx - nearestX;\n  const distY = cy - nearestY;\n  return distX * distX + distY * distY <= cr * cr;\n};\nconst collideHeroTir = (h, oc) => {\n  const hx = h.coord.x;\n  const hy = h.coord.y;\n  const hw = h.hitBox.hx;\n  const hh = h.hitBox.hy;\n  const cx = oc.coord.x;\n  const cy = oc.coord.y;\n  const cr = 5;\n  const nearestX = Math.max(hx - hw / 2, Math.min(cx, hx + hw / 2));\n  const nearestY = Math.max(hy - hh / 2, Math.min(cy, hy + hh / 2));\n  const distX = cx - nearestX;\n  const distY = cy - nearestY;\n  return distX * distX + distY * distY <= cr * cr;\n};\nconst collideEnnemieTir = (h, oc) => {\n  const hx = h.coord.x;\n  const hy = h.coord.y;\n  const hw = h.width;\n  const hh = h.height;\n  const cx = oc.coord.x;\n  const cy = oc.coord.y;\n  const cr = 5;\n  const nearestX = Math.max(hx, Math.min(cx, hx + hw));\n  const nearestY = Math.max(hy, Math.min(cy, hy + hh));\n  const distX = cx - nearestX;\n  const distY = cy - nearestY;\n  return distX * distX + distY * distY <= cr * cr;\n};\nconst collideBORR = (b, or) => dist2(b, {\n  x: or.rightBottom.x,\n  y: or.leftTop.y,\n  dx: 0,\n  dy: 0\n}) < Math.pow(conf.RADIUS, 2) || dist2(b, {\n  x: or.rightBottom.x,\n  y: or.rightBottom.y,\n  dx: 0,\n  dy: 0\n}) < Math.pow(conf.RADIUS, 2) || dist2(b, {\n  x: or.rightBottom.x,\n  y: b.y,\n  dx: 0,\n  dy: 0\n}) < Math.pow(conf.RADIUS, 2) && b.y > or.leftTop.y && b.y < or.rightBottom.y;\nconst collideBORL = (b, or) => dist2(b, {\n  x: or.leftTop.x,\n  y: or.rightBottom.y,\n  dx: 0,\n  dy: 0\n}) < Math.pow(conf.RADIUS, 2) || dist2(b, {\n  x: or.leftTop.x,\n  y: or.leftTop.y,\n  dx: 0,\n  dy: 0\n}) < Math.pow(conf.RADIUS, 2) || dist2(b, {\n  x: or.leftTop.x,\n  y: b.y,\n  dx: 0,\n  dy: 0\n}) < Math.pow(conf.RADIUS, 2) && b.y > or.leftTop.y && b.y < or.rightBottom.y;\nconst collideBORU = (b, or) => dist2(b, {\n  x: or.rightBottom.x,\n  y: or.leftTop.y,\n  dx: 0,\n  dy: 0\n}) < Math.pow(conf.RADIUS, 2) || dist2(b, {\n  x: or.leftTop.x,\n  y: or.leftTop.y,\n  dx: 0,\n  dy: 0\n}) < Math.pow(conf.RADIUS, 2) || dist2(b, {\n  x: b.x,\n  y: or.leftTop.y,\n  dx: 0,\n  dy: 0\n}) < Math.pow(conf.RADIUS, 2) && b.x > or.leftTop.x && b.x < or.rightBottom.x;\nconst collideBORB = (b, or) => dist2(b, {\n  x: or.leftTop.x,\n  y: or.rightBottom.y,\n  dx: 0,\n  dy: 0\n}) < Math.pow(conf.RADIUS, 2) || dist2(b, {\n  x: or.rightBottom.x,\n  y: or.rightBottom.y,\n  dx: 0,\n  dy: 0\n}) < Math.pow(conf.RADIUS, 2) || dist2(b, {\n  x: b.x,\n  y: or.rightBottom.y,\n  dx: 0,\n  dy: 0\n}) < Math.pow(conf.RADIUS, 2) && b.x > or.leftTop.x && b.x < or.rightBottom.x;\nconst collide = (o1, o2) => dist2(o1, o2) < Math.pow(2 * conf.RADIUS, 2);\nconst collideboing = (p1, p2) => {\n  const nx = (p2.x - p1.x) / (2 * conf.RADIUS);\n  const ny = (p2.y - p1.y) / (2 * conf.RADIUS);\n  const gx = -ny;\n  const gy = nx;\n  const v1g = gx * p1.dx + gy * p1.dy;\n  const v2n = nx * p2.dx + ny * p2.dy;\n  const v2g = gx * p2.dx + gy * p2.dy;\n  const v1n = nx * p1.dx + ny * p1.dy;\n  p1.dx = nx * v2n + gx * v1g;\n  p1.dy = ny * v2n + gy * v1g;\n  p2.dx = nx * v1n + gx * v2g;\n  p2.dy = ny * v1n + gy * v2g;\n  p1.x += p1.dx;\n  p1.y += p1.dy;\n  p2.x += p2.dx;\n  p2.y += p2.dy;\n};\nconst collideboingS = (p1, p2) => {\n  const nx = (p2.coord.x - p1.x) / (2 * conf.RADIUS);\n  const ny = (p2.coord.y - p1.y) / (2 * conf.RADIUS);\n  const gx = -ny;\n  const gy = nx;\n  const v1g = gx * p1.dx + gy * p1.dy;\n  const v1n = nx * p1.dx + ny * p1.dy;\n  p1.dx -= 2 * nx + gx * v1g;\n  p1.dy -= 2 * ny + gy * v1g;\n  p1.x += p1.dx;\n  p1.y += p1.dy;\n};\nexport const step = state => {\n  state.pos.map((p1, i, arr) => {\n    arr.slice(i + 1).map(p2 => {\n      if (collide(p1.coord, p2.coord)) {\n        if (!p1.invincible) {\n          p1.life--;\n          p1.invincible = 20;\n        }\n        if (!p2.invincible) {\n          p2.life--;\n          p2.invincible = 20;\n        }\n        collideboing(p1.coord, p2.coord);\n      }\n    });\n  });\n\n  // Gestion du délai de tir\n  const shootingDelay = 60;\n  if (state.shootCooldownHero <= 0) {\n    state.tirs.push({\n      life: 1,\n      coord: {\n        x: state.hero.coord.x,\n        y: state.hero.coord.y,\n        dx: 0,\n        dy: -2\n      }\n    });\n    state.shootCooldownHero = shootingDelay;\n  } else {\n    state.shootCooldownHero--;\n  }\n  state.ennemisQuiTire = state.ennemisQuiTire.map(([cooldown, ennemie]) => {\n    console.log(cooldown);\n    if (cooldown <= 0) {\n      state.tirsEnnemie.push({\n        life: 1,\n        coord: {\n          x: ennemie.coord.x + 25,\n          y: ennemie.coord.y + 50,\n          dx: 0,\n          dy: 2\n        }\n      });\n      return [100, ennemie];\n    }\n    return [cooldown - 1, ennemie];\n  });\n\n  //Gestion du délai d'apparition d'ennemis\n  const appearanceDelay = 200;\n  if (state.ennemyDelay <= 0) {\n    switch (randomInt(3)) {\n      case 1:\n        //possibilité d'algo de gravité\n        state.debris.push({\n          coord: {\n            x: randomInt(window.innerWidth - (120 + 2 * conf.BOUNDLEFT)) + (60 + conf.BOUNDLEFT),\n            y: 0,\n            dx: 0,\n            dy: 2\n          },\n          radius: 25,\n          life: 2 // faire un truc en fonction du rayon pour la vie\n        });\n        break;\n      case 2:\n        state.ennemisQuiTire.push([100, {\n          coord: {\n            x: randomInt(window.innerWidth - (120 + 2 * conf.BOUNDLEFT)) + (60 + conf.BOUNDLEFT),\n            y: 0,\n            dx: 0,\n            dy: 4\n          },\n          width: 50,\n          height: 50,\n          life: 2 //possibilité de modifier la vie\n        }]);\n        break;\n      default:\n        break;\n    }\n    state.ennemyDelay = appearanceDelay;\n  } else {\n    state.ennemyDelay--;\n  }\n\n  //Collision débris - tir\n  state.tirs.map(p1 => {\n    state.debris.map(c => {\n      if (collideBOC(p1.coord, c)) {\n        p1.life--;\n        c.life--;\n      }\n    });\n  });\n  state.tirsEnnemie.map(p => {\n    const coordH = state.hero.coord;\n    if (collideHeroTir(state.hero, p)) {\n      p.life = 0;\n      state.hero.vie--;\n    }\n  });\n  state.ennemisQuiTire.map(([_, r]) => {\n    state.tirs.map(p => {\n      if (collideEnnemieTir(r, p)) {\n        r.life--;\n        p.life = 0;\n      }\n    });\n  });\n  if (state.hero.vie == 0) {\n    state.hero.coord.x = 1;\n    state.endOfGame = true;\n  }\n\n  //Collision debri-héros\n  state.debris.map(d => {\n    if (collideROC(state.hero, d)) {\n      d.life = 0;\n      state.hero.vie--;\n    }\n  });\n  return {\n    ...state,\n    pos: state.pos.map(iterate(state.size)).filter(p => p.life > 0),\n    tirs: state.tirs.map(iterate(state.size)).filter(p => p.coord.y > 0 && p.life > 0),\n    tirsEnnemie: state.tirsEnnemie.map(iterate(state.size)).filter(p => p.coord.y > 0 && p.life > 0),\n    debris: state.debris.map(mouvDebris(state.size)).filter(p => p.coord.y < window.innerHeight && p.life > 0),\n    ennemisQuiTire: state.ennemisQuiTire.map(mouvTirD(state.size)).filter(([_, rect]) => rect.coord.y < window.innerHeight && rect.life > 0),\n    endOfGame: state.endOfGame\n  };\n};\nexport const handleKeyPress = state => event => {\n  const stepx = state.hero.coord.dx;\n  const stepy = state.hero.coord.dy;\n  const ax = state.hero.coord.x;\n  const ay = state.hero.coord.y;\n  const hx = state.hero.hitBox.hx / 2;\n  const hy = state.hero.hitBox.hy / 2;\n  switch (event.key) {\n    case \"Z\":\n    case \"z\":\n      console.log(\"z\");\n      if (ay - stepy - hy > state.limite[0].rightBottom.y) {\n        return {\n          ...state,\n          hero: {\n            ...state.hero,\n            coord: {\n              ...state.hero.coord,\n              y: ay - stepy\n            }\n          }\n        };\n      }\n      return state;\n    case \"s\":\n    case \"S\":\n      console.log(\"s\");\n      if (ay + stepy + hy < state.limite[3].leftTop.y) {\n        return {\n          ...state,\n          hero: {\n            ...state.hero,\n            coord: {\n              ...state.hero.coord,\n              y: ay + stepy\n            }\n          }\n        };\n      }\n      return state;\n    case \"q\":\n    case \"Q\":\n      console.log(\"q\");\n      if (ax - stepx - hx > state.limite[1].rightBottom.x) {\n        return {\n          ...state,\n          hero: {\n            ...state.hero,\n            coord: {\n              ...state.hero.coord,\n              x: ax - stepx\n            }\n          }\n        };\n      }\n      return state;\n    case \"d\":\n    case \"D\":\n      console.log(\"d\");\n      if (ax + stepx + hx < state.limite[2].leftTop.x) {\n        return {\n          ...state,\n          hero: {\n            ...state.hero,\n            coord: {\n              ...state.hero.coord,\n              x: ax + stepx\n            }\n          }\n        };\n      }\n      return state;\n    default:\n      return state;\n  }\n};\nexport const mouseMove = state => event => {\n  return state;\n};\nexport const endOfGame = state => true;","map":{"version":3,"names":["conf","randomInt","max","Math","floor","random","randomSign","sign","dist2","o1","o2","pow","x","y","iterate","bound","ball","coord","dx","dy","mouvDebris","mouvTirD","i","rect","newdy","click","state","event","offsetX","offsetY","target","pos","find","p","RADIUS","collideBOC","b","oc","radius","collideROC","h","hx","hy","hw","hitBox","hh","cx","cy","cr","nearestX","min","nearestY","distX","distY","collideHeroTir","collideEnnemieTir","width","height","collideBORR","or","rightBottom","leftTop","collideBORL","collideBORU","collideBORB","collide","collideboing","p1","p2","nx","ny","gx","gy","v1g","v2n","v2g","v1n","collideboingS","step","map","arr","slice","invincible","life","shootingDelay","shootCooldownHero","tirs","push","hero","ennemisQuiTire","cooldown","ennemie","console","log","tirsEnnemie","appearanceDelay","ennemyDelay","debris","window","innerWidth","BOUNDLEFT","c","coordH","vie","_","r","endOfGame","d","size","filter","innerHeight","handleKeyPress","stepx","stepy","ax","ay","key","limite","mouseMove"],"sources":["D:/varlesse/Documents/GitHub/try/ProjetCPAWEB/web/src/components/canvas/state.ts"],"sourcesContent":["import { useEffect } from 'react';\r\nimport * as conf from './conf'\r\nexport type Coord = { x: number; y: number; dx: number; dy: number }\r\nexport type Point = {x:number; y: number}\r\ntype Ball = { coord: Coord; life: number; invincible?: number }\r\ntype Size = { height: number; width: number }\r\ntype Wall = { leftTop:Point, rightBottom:Point}\r\ntype ObjectCercle = {coord: Coord; radius: number; life: number}\r\nexport type Rectangle = {coord: Coord, width:number, height:number, life: number}\r\ntype Hero = {coord: Coord, hitBox: {hx: number, hy: number}, vie: number, force : number}\r\n\r\n// Mur de droite = 1 et Mur haut = 0 et Mur gauche = 2  \r\n\r\nconst randomInt = (max: number) => Math.floor(Math.random() * max)\r\nconst randomSign = () => Math.sign(Math.random() - 0.5)\r\n\r\nexport type State = {\r\n  hero : Hero\r\n  pos: Array<Ball>\r\n  limite: Array<Wall>\r\n  size: Size\r\n  endOfGame: boolean\r\n  tirs: Array<Ball>\r\n  debris: Array<ObjectCercle>\r\n  ennemisQuiTire: Array<[number, Rectangle]>\r\n  tirsEnnemie: Array<Ball>\r\n  shootCooldownHero : number\r\n  ennemyDelay : number\r\n}\r\n\r\nconst dist2 = (o1: Coord, o2: Coord) =>\r\n  Math.pow(o1.x - o2.x, 2) + Math.pow(o1.y - o2.y, 2)\r\n\r\nconst iterate = (bound: Size) => (ball: Ball) => {\r\n  \r\n  return {\r\n    ...ball, \r\n    coord: {\r\n      ...ball.coord,\r\n      x: ball.coord.x + ball.coord.dx,\r\n      y: ball.coord.y + ball.coord.dy,\r\n    },\r\n  }\r\n}\r\n\r\nconst mouvDebris = (bound: Size) => (ball: ObjectCercle) => {\r\n  \r\n  return {\r\n    ...ball, \r\n    coord: {\r\n      ...ball.coord,\r\n      x: ball.coord.x + ball.coord.dx,\r\n      y: ball.coord.y + ball.coord.dy,\r\n    },\r\n  }\r\n}\r\n\r\nconst mouvTirD = (bound: Size) => ([i, rect]: [number, Rectangle]) => {\r\n\r\n  let newdy = rect.coord.dy\r\n  if (rect.coord.y === 200) {\r\n    newdy = 0\r\n  }\r\n\r\n  return [\r\n    i,\r\n    {\r\n      ...rect,\r\n      coord: {\r\n        ...rect.coord,\r\n        y: rect.coord.y + newdy,\r\n        dy: newdy,\r\n      },\r\n    },\r\n  ]as [number, Rectangle];;\r\n}\r\n\r\n\r\nexport const click =\r\n  (state: State) =>\r\n  (event: PointerEvent): State => {\r\n    const { offsetX, offsetY } = event\r\n    const target = state.pos.find(\r\n      (p) =>\r\n        dist2(p.coord, { x: offsetX, y: offsetY, dx: 0, dy: 0 }) <\r\n        Math.pow(conf.RADIUS, 2) + 100\r\n    )\r\n    if (target) {\r\n      target.coord.dx += Math.random() * 10\r\n      target.coord.dy += Math.random() * 10\r\n    }\r\n    return state\r\n  }\r\n\r\n\r\nconst collideBOC = (b:Coord, oc:ObjectCercle) => \r\n  dist2(b, {x: oc.coord.x, y: oc.coord.y, dx: 0, dy: 0}) < Math.pow(conf.RADIUS+oc.radius, 2)\r\n\r\nconst collideROC = (h: Hero, oc: ObjectCercle) => {\r\n  const hx = h.coord.x;\r\n  const hy = h.coord.y;\r\n  const hw = h.hitBox.hx;\r\n  const hh = h.hitBox.hy;\r\n  const cx = oc.coord.x;\r\n  const cy = oc.coord.y;\r\n  const cr = oc.radius;\r\n  const nearestX = Math.max(hx - hw / 2, Math.min(cx, hx + hw / 2));\r\n  const nearestY = Math.max(hy - hh / 2, Math.min(cy, hy + hh / 2));\r\n  const distX = cx - nearestX;\r\n  const distY = cy - nearestY;\r\n  return (distX * distX + distY * distY) <= (cr * cr);\r\n};\r\n  \r\nconst collideHeroTir = (h: Hero, oc: Ball) => {\r\n  const hx = h.coord.x;\r\n  const hy = h.coord.y;\r\n  const hw = h.hitBox.hx;\r\n  const hh = h.hitBox.hy;\r\n  const cx = oc.coord.x;\r\n  const cy = oc.coord.y;\r\n  const cr = 5;\r\n  const nearestX = Math.max(hx - hw / 2, Math.min(cx, hx + hw / 2));\r\n  const nearestY = Math.max(hy - hh / 2, Math.min(cy, hy + hh / 2));\r\n  const distX = cx - nearestX;\r\n  const distY = cy - nearestY;\r\n  return (distX * distX + distY * distY) <= (cr * cr);\r\n};\r\n\r\nconst collideEnnemieTir = (h: Rectangle, oc: Ball) => {\r\n  const hx = h.coord.x;\r\n  const hy = h.coord.y;\r\n  const hw = h.width;\r\n  const hh = h.height;\r\n  const cx = oc.coord.x;\r\n  const cy = oc.coord.y;\r\n  const cr = 5;\r\n  const nearestX = Math.max(hx, Math.min(cx, hx + hw));\r\n  const nearestY = Math.max(hy, Math.min(cy, hy + hh));\r\n  const distX = cx - nearestX;\r\n  const distY = cy - nearestY;\r\n  return (distX * distX + distY * distY) <= (cr * cr);\r\n};\r\n  \r\nconst collideBORR = (b:Coord, or:Wall) => \r\n  ((dist2(b, {x: or.rightBottom.x, y: or.leftTop.y, dx: 0, dy: 0}) < Math.pow(conf.RADIUS, 2)) || \r\n  (dist2(b, {x: or.rightBottom.x, y: or.rightBottom.y, dx: 0, dy: 0}) < Math.pow(conf.RADIUS, 2))) || \r\n  (dist2(b, {x: or.rightBottom.x, y:b.y, dx:0, dy:0}) < Math.pow(conf.RADIUS,2) && b.y > or.leftTop.y && b.y < or.rightBottom.y)\r\n\r\nconst collideBORL = (b:Coord, or: Wall) => \r\n  (dist2(b, {x: or.leftTop.x, y: or.rightBottom.y, dx: 0, dy: 0}) < Math.pow(conf.RADIUS, 2)) || \r\n  (dist2(b, {x: or.leftTop.x, y: or.leftTop.y, dx: 0, dy: 0}) < Math.pow(conf.RADIUS, 2)) || \r\n  (dist2(b, {x: or.leftTop.x, y:b.y, dx:0, dy:0}) < Math.pow(conf.RADIUS,2) && b.y > or.leftTop.y && b.y < or.rightBottom.y)\r\n\r\nconst collideBORU = (b:Coord, or:Wall) =>\r\n  (dist2(b, {x: or.rightBottom.x, y: or.leftTop.y, dx: 0, dy: 0}) < Math.pow(conf.RADIUS, 2)) || \r\n  (dist2(b, {x: or.leftTop.x, y: or.leftTop.y, dx: 0, dy: 0}) < Math.pow(conf.RADIUS, 2)) || \r\n  (dist2(b, {x: b.x, y:or.leftTop.y, dx:0, dy:0}) < Math.pow(conf.RADIUS,2) && b.x > or.leftTop.x && b.x < or.rightBottom.x) \r\n\r\n\r\nconst collideBORB = (b:Coord, or:Wall) =>\r\n  (dist2(b, {x: or.leftTop.x, y: or.rightBottom.y, dx: 0, dy: 0}) < Math.pow(conf.RADIUS, 2)) || \r\n  (dist2(b, {x: or.rightBottom.x, y: or.rightBottom.y, dx: 0, dy: 0}) < Math.pow(conf.RADIUS, 2)) || \r\n  (dist2(b, {x: b.x, y:or.rightBottom.y, dx:0, dy:0}) < Math.pow(conf.RADIUS,2) && b.x > or.leftTop.x && b.x < or.rightBottom.x) \r\n\r\n\r\nconst collide = (o1: Coord, o2: Coord) =>\r\n  dist2(o1, o2) < Math.pow(2 * conf.RADIUS, 2)\r\n\r\nconst collideboing = (p1: Coord, p2: Coord) => {\r\n  const nx = (p2.x - p1.x) / (2 * conf.RADIUS)\r\n  const ny = (p2.y - p1.y) / (2 * conf.RADIUS)\r\n  const gx = -ny\r\n  const gy = nx\r\n\r\n  const v1g = gx * p1.dx + gy * p1.dy\r\n  const v2n = nx * p2.dx + ny * p2.dy\r\n  const v2g = gx * p2.dx + gy * p2.dy\r\n  const v1n = nx * p1.dx + ny * p1.dy\r\n  p1.dx = nx * v2n + gx * v1g\r\n  p1.dy = ny * v2n + gy * v1g\r\n  p2.dx = nx * v1n + gx * v2g\r\n  p2.dy = ny * v1n + gy * v2g\r\n  p1.x += p1.dx\r\n  p1.y += p1.dy\r\n  p2.x += p2.dx\r\n  p2.y += p2.dy\r\n}\r\n\r\nconst collideboingS = (p1: Coord, p2:ObjectCercle) => {\r\n  const nx = (p2.coord.x-p1.x) / (2 * conf.RADIUS)\r\n  const ny = (p2.coord.y-p1.y) / (2 * conf.RADIUS)\r\n  const gx = -ny\r\n  const gy = nx\r\n\r\n  const v1g = gx * p1.dx + gy * p1.dy\r\n  const v1n = nx * p1.dx + ny * p1.dy\r\n  p1.dx -= 2 * nx  + gx * v1g\r\n  p1.dy -= 2 * ny  + gy * v1g\r\n  p1.x += p1.dx\r\n  p1.y += p1.dy\r\n  \r\n}\r\n\r\nexport const step = (state: State) => {\r\n    \r\n  state.pos.map((p1, i, arr) => {\r\n    arr.slice(i + 1).map((p2) => {\r\n      if (collide(p1.coord, p2.coord)) {\r\n        if (!p1.invincible) {\r\n          p1.life--\r\n          p1.invincible = 20\r\n        }\r\n        if (!p2.invincible) {\r\n          p2.life--\r\n          p2.invincible = 20\r\n        }\r\n        collideboing(p1.coord, p2.coord)\r\n      }\r\n    })\r\n  })\r\n\r\n\r\n  // Gestion du délai de tir\r\n  const shootingDelay = 60; \r\n\r\n  if (state.shootCooldownHero <= 0) {\r\n    state.tirs.push({\r\n      life: 1,\r\n      coord: {\r\n        x: state.hero.coord.x,\r\n        y: state.hero.coord.y,\r\n        dx: 0,\r\n        dy: -2,\r\n      },\r\n    });\r\n    state.shootCooldownHero = shootingDelay;\r\n  } else {\r\n    state.shootCooldownHero--;\r\n  }\r\n\r\n  state.ennemisQuiTire = state.ennemisQuiTire.map(([cooldown, ennemie]:[number, Rectangle]) =>{\r\n    console.log(cooldown);\r\n    if (cooldown <= 0) {\r\n      state.tirsEnnemie.push({\r\n        life:1,\r\n      coord: {\r\n        x: ennemie.coord.x+25,\r\n        y: ennemie.coord.y+50,\r\n        dx: 0,\r\n        dy: 2,\r\n      },\r\n      })\r\n      return [100, ennemie];\r\n    }\r\n    return [cooldown-1, ennemie];\r\n  }\r\n)\r\n\r\n\r\n  \r\n  //Gestion du délai d'apparition d'ennemis\r\n  const appearanceDelay = 200;\r\n  if (state.ennemyDelay <= 0) {\r\n    \r\n    switch (randomInt(3)){\r\n\r\n      case 1 :\r\n        //possibilité d'algo de gravité\r\n        state.debris.push(\r\n          {coord:{\r\n            x: randomInt(window.innerWidth - (120+(2*conf.BOUNDLEFT))) + (60+conf.BOUNDLEFT),\r\n            y: 0,\r\n            dx:0, \r\n            dy:2},\r\n          radius : 25,\r\n          life : 2 // faire un truc en fonction du rayon pour la vie\r\n        });\r\n        break;\r\n\r\n      case 2 :\r\n        state.ennemisQuiTire.push([ \r\n          100,\r\n          {coord: {\r\n            x: randomInt(window.innerWidth - (120+(2*conf.BOUNDLEFT))) + (60+conf.BOUNDLEFT),\r\n            y: 0,\r\n            dx:0, \r\n            dy:4 },\r\n          width:50, \r\n          height:50, \r\n          life: 2 //possibilité de modifier la vie\r\n          }\r\n        ])\r\n        break;\r\n\r\n      default : \r\n        break\r\n\r\n    }\r\n    \r\n    state.ennemyDelay = appearanceDelay;\r\n  } else {\r\n    state.ennemyDelay--;\r\n  }\r\n\r\n  //Collision débris - tir\r\n  state.tirs.map((p1) => {\r\n    state.debris.map((c) => {\r\n      if (collideBOC(p1.coord, c)){\r\n        p1.life--\r\n        c.life--\r\n      }\r\n    })\r\n  })\r\n\r\n  state.tirsEnnemie.map((p) => {\r\n    const coordH = state.hero.coord\r\n    if (collideHeroTir(state.hero, p)){\r\n      p.life = 0;\r\n      state.hero.vie --;\r\n    }\r\n  })\r\n\r\n  state.ennemisQuiTire.map(([_,r]) => {\r\n    state.tirs.map((p)=> {\r\n      if (collideEnnemieTir(r, p)){\r\n        r.life--;\r\n        p.life = 0;\r\n      }\r\n    })\r\n  })\r\n\r\n\r\n  if(state.hero.vie == 0) {\r\n    state.hero.coord.x =1\r\n    state.endOfGame = true\r\n  }\r\n\r\n  //Collision debri-héros\r\n  state.debris.map((d) => {\r\n    if (collideROC(state.hero,d)) {\r\n      d.life = 0\r\n      state.hero.vie --;\r\n    }\r\n\r\n  })\r\n\r\n\r\n  return {\r\n    ...state,\r\n    pos: state.pos.map(iterate(state.size)).filter((p) => p.life > 0),\r\n    tirs: state.tirs.map(iterate(state.size)).filter((p) => p.coord.y > 0 && p.life > 0),\r\n    tirsEnnemie: state.tirsEnnemie.map(iterate(state.size)).filter((p) => p.coord.y > 0 && p.life > 0),\r\n    debris: state.debris.map(mouvDebris(state.size)).filter((p) => p.coord.y < window.innerHeight && p.life > 0),\r\n    ennemisQuiTire: state.ennemisQuiTire.map(mouvTirD(state.size)).filter(([_, rect]) => rect.coord.y < window.innerHeight && rect.life > 0),\r\n    endOfGame: state.endOfGame,\r\n  }\r\n}\r\n\r\nexport const handleKeyPress = \r\n  (state: State) =>\r\n    (event: KeyboardEvent):State => { \r\n        const stepx = state.hero.coord.dx;\r\n        const stepy = state.hero.coord.dy;\r\n        const ax = state.hero.coord.x;\r\n        const ay = state.hero.coord.y;\r\n        const hx = state.hero.hitBox.hx/2;\r\n        const hy = state.hero.hitBox.hy/2;\r\n        switch (event.key) {\r\n          case \"Z\":\r\n          case \"z\":\r\n            console.log(\"z\")\r\n            \r\n            if (ay - stepy - hy > state.limite[0].rightBottom.y){\r\n              return {...state, hero:{...state.hero, coord: {...state.hero.coord, y: ay - stepy}}}\r\n            }\r\n            return state;\r\n          case \"s\":\r\n          case \"S\":\r\n            console.log(\"s\")\r\n            if (ay + stepy+ hy< state.limite[3].leftTop.y){\r\n              return {...state, hero:{...state.hero, coord: {...state.hero.coord, y: ay + stepy}}}\r\n            }\r\n            return state;\r\n          case \"q\":\r\n          case \"Q\":\r\n            console.log(\"q\")\r\n            if (ax - stepx - hx> state.limite[1].rightBottom.x){\r\n              return {...state, hero:{...state.hero, coord: {...state.hero.coord, x: ax - stepx}}}\r\n            }\r\n            return state;\r\n          case \"d\":\r\n          case \"D\":\r\n            console.log(\"d\")\r\n            if (ax + stepx + hx < state.limite[2].leftTop.x){\r\n              return {...state, hero:{...state.hero, coord: {...state.hero.coord, x: ax + stepx}}}\r\n            }\r\n            return state;\r\n          default : \r\n            return state\r\n        }\r\n      }\r\n\r\nexport const mouseMove =\r\n  (state: State) =>\r\n  (event: PointerEvent): State => {\r\n    return state\r\n  }\r\n\r\nexport const endOfGame = (state: State): boolean => true\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}